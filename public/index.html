<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  <style>
    li:hover {background: green;}
  </style>
</head>
<body>
  <h1>Testing API</h1>
  <div class="loginSignUp">
    <input type="text" value='user@user.com' id="email" placeholder="Enter Email">
    <input type="text" value='duck' id="password" placeholder="Enter Pass">
    <button id="login">Login</button>
    <button id="signup">SignUp</button>
    <button id="confirm">Confirm</button>
  </div>

  <div class="beer">
    <input type="text" id="beerName" placeholder="Enter Beer Name">

    <button id="beer">Beer</button>
    <button id="addBeer">Add Beer</button>
    <button id="updateBeer">Update Beer</button>
    <button id="deleteBeer">Delete Beer</button>
  </div>


  <ul id="info"></ul>

  <script>
  $('#confirm').hide();
//--------------------------------
  // USER
  var confirmLink = '';

    $('#signup').on('click', function(){
      var email = $('#email')[0].value
      var password = $('#password')[0].value
      var passwordConfirm = $('#password')[0].value

      var settings = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/users",
        method: "POST",
        data: '{"user": {"email": "' + email +'", "password": "' + password + '",' + '"password_confirmation": "'+ passwordConfirm + '"}}',
        headers: {
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settings).done(function (response) {
        console.log("Signup run: ")
        console.log(response);

        confirmLink = response['confirm_link']

        $('#info').append(response)
        $('#confirm').show();
      });

    });
    $('#confirm').on('click', function(){
      var settingsConfirm = {
          "async": true,
          "crossDomain": true,
          "url": confirmLink,
          "method": "POST",
          "headers": {
            "cache-control": "no-cache"
          }
        }

        $.ajax(settingsConfirm).done(function (response) {
          console.log("confirm run: ")
          console.log(response);
          $('#confirm').hide();
        });
    });

//--------------------------------
  // LOGIN
    $('#login').on('click', function(){
      var email = $('#email')[0].value
      var password = $('#password')[0].value

      var settingsLogin = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/users/login",
        method: "POST",
        data: '{"email": "' + email +'", "password": "' + password + '"}',
        headers: {
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settingsLogin).done(function (response) {
        console.log(response);
        localStorage.setItem('id_token', response['auth_token'])
        $('#info').append("User is Logged in and token is set.")
        token = response['auth_token'];
      });

    })
//--------------------------------
  // BEER
    $('#beer').on('click', function(){

      var settingsBeer = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/beers",
        method: "GET",
        headers: {
          "authorization": "Bearer " + localStorage.getItem('id_token')
        }
      }

      $.ajax(settingsBeer).done(function (response) {
        response.forEach(function(b){
          // console.log(b)
          $('#info').append("<li id=" + b.id + "> " + b.name +" | " + b.style + "</li>")
        })

      });
    })

    $('#addBeer').on('click', function(){
      var name = $('#beerName')[0].value;

      var settings = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/beers",
        method: "POST",
        data: '{"beer": {"name": "' + name + '"}}',
        headers: {
          "authorization": "Bearer " + localStorage.getItem('id_token'),
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settings).done(function (response) {
        console.log(response);
        $('#info').append(response + "\n")
      });
    })

    $('#updateBeer').on('click', function(){
      var name = $('#beerName')[0].value;
      var settings = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/beers/" + name,
        method: "PUT",
        data: '{"beer": {"style": "Coolness"}}',
        headers: {
          "authorization": "Bearer " + localStorage.getItem('id_token'),
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settings).done(function (response) {
        console.log(response);
        $('#info').append(response + "\n")
      });
    })
    $('#deleteBeer').on('click', function(){
      var name = $('#beerName')[0].value;
      var settings = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/beers/" + name,
        method: "DELETE",
        headers: {
          "authorization": "Bearer " + localStorage.getItem('id_token'),
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settings).done(function (response) {
        console.log(response);
        $('#info').append(response + "\n")
      });
    })

    $('#info').on('click', function(e){
      var name = e.target.id;
      var settings = {
        async: true,
        crossDomain: true,
        url: "http://localhost:3000/beers/" + name,
        method: "DELETE",
        headers: {
          "authorization": "Bearer " + localStorage.getItem('id_token'),
          "content-type": "application/json",
          "cache-control": "no-cache"
        },
        error: function(e){console.log(e.responseText)}
      }

      $.ajax(settings).done(function (response) {
        console.log(response);
        $('#' + name).remove();
      });

    })
  </script>
</body>
</html>
